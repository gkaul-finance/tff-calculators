<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch 3: Loan Amortization Calculator | The Finance Framework</title>
    <style>
        :root { --maize: #FFCB05; --blue: #00274C; --light-blue: #E6EEF4; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .header { background-color: var(--blue); color: white; padding: 20px; border-radius: 12px 12px 0 0; text-align: center; }
        .header .chapter { font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px; }
        .header h1 { font-size: 1.5rem; font-weight: 600; margin-bottom: 8px; }
        .header p { font-size: 0.85rem; opacity: 0.8; }
        .main-content { background-color: var(--light-blue); padding: 20px; border-radius: 0 0 12px 12px; border: 2px solid var(--blue); border-top: none; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 6px; color: var(--blue); font-size: 0.9rem; }
        .input-wrapper { position: relative; }
        .input-wrapper .prefix, .input-wrapper .suffix { position: absolute; top: 50%; transform: translateY(-50%); color: #666; font-weight: 500; }
        .input-wrapper .prefix { left: 12px; }
        .input-wrapper .suffix { right: 12px; }
        input, select { width: 100%; padding: 12px; font-size: 1rem; border: 2px solid var(--maize); border-radius: 8px; background-color: white; }
        input:focus, select:focus { outline: none; border-color: var(--blue); }
        input.has-prefix { padding-left: 28px; }
        input.has-suffix { padding-right: 40px; }
        select { cursor: pointer; color: var(--blue); font-weight: 500; }
        .input-row { display: flex; gap: 15px; }
        .input-row .form-group { flex: 1; }
        .button-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn { padding: 14px; font-size: 1rem; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; }
        .btn-primary { flex: 2; background-color: var(--maize); color: var(--blue); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,39,76,0.3); }
        .btn-secondary { flex: 1; background-color: white; color: var(--blue); border: 2px solid var(--blue); }
        .error-box { background-color: #fee2e2; color: #dc2626; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem; text-align: center; display: none; }
        .summary-box { background-color: var(--blue); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px; display: none; }
        .summary-box h3 { color: var(--maize); font-size: 1.1rem; margin-bottom: 15px; text-align: center; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .summary-item { text-align: center; }
        .summary-item .label { font-size: 0.8rem; opacity: 0.9; margin-bottom: 4px; }
        .summary-item .value { font-size: 1.3rem; font-weight: 700; color: var(--maize); }
        .schedule-container { background-color: white; border-radius: 8px; overflow: hidden; display: none; }
        .schedule-header { background-color: var(--blue); color: white; padding: 12px 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .schedule-header button { background-color: var(--maize); color: var(--blue); border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; cursor: pointer; }
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .schedule-table th { background-color: var(--light-blue); color: var(--blue); padding: 10px 8px; text-align: right; font-weight: 600; border-bottom: 2px solid var(--blue); }
        .schedule-table th:first-child { text-align: center; }
        .schedule-table td { padding: 10px 8px; text-align: right; border-bottom: 1px solid #eee; }
        .schedule-table td:first-child { text-align: center; font-weight: 600; color: var(--blue); }
        .schedule-table tr:nth-child(even) { background-color: #f9f9f9; }
        .schedule-table .interest { color: #dc2626; }
        .schedule-table .principal { color: #16a34a; }
        .footer { text-align: center; margin-top: 15px; font-size: 0.8rem; color: #999; }
    
        .philosophy-note {
            background: #fffbeb;
            border: 1px solid #f6e05e;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 0.82rem;
            color: #744210;
            text-align: center;
            line-height: 1.5;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="chapter">Chapter 3</div>
            <h1>Loan Amortization Calculator</h1>
            <p>The Finance Framework</p>
        </div>
        
        <div class="main-content">
            <div class="philosophy-note">
                This calculator is an example of what can be built for a specific numerical problem—not a substitute for understanding. Real financial analysis requires building your own models, because the process of building is where understanding lives. The exercises in the book do not all require this calculator. Many are deliberately conceptual, because finance is ultimately about how you think, not how you calculate.
            </div>
            <div class="form-group">
                <label>Loan Amount (Principal)</label>
                <div class="input-wrapper">
                    <span class="prefix">$</span>
                    <input type="number" id="principal" class="has-prefix" placeholder="e.g., 250000">
                </div>
            </div>
            
            <div class="input-row">
                <div class="form-group">
                    <label>Annual Interest Rate</label>
                    <div class="input-wrapper">
                        <input type="number" id="annualRate" step="0.01" class="has-suffix" placeholder="e.g., 6.5">
                        <span class="suffix">%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Loan Term</label>
                    <div class="input-wrapper">
                        <input type="number" id="loanTerm" step="1" class="has-suffix" placeholder="e.g., 30">
                        <span class="suffix">yrs</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>Payment Frequency</label>
                <select id="frequency">
                    <option value="12">Monthly</option>
                    <option value="26">Bi-weekly</option>
                    <option value="52">Weekly</option>
                    <option value="4">Quarterly</option>
                    <option value="1">Annual</option>
                </select>
            </div>
            
            <div class="button-row">
                <button class="btn btn-primary" onclick="calculate()">Generate Schedule</button>
                <button class="btn btn-secondary" onclick="clearAll()">Clear</button>
            </div>
            
            <div class="error-box" id="error"></div>
            
            <div class="summary-box" id="summary">
                <h3>Loan Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="label">Payment Amount</div>
                        <div class="value" id="summary-payment">$0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Total Payments</div>
                        <div class="value" id="summary-total">$0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Total Interest</div>
                        <div class="value" id="summary-interest">$0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Interest % of Principal</div>
                        <div class="value" id="summary-percent">0%</div>
                    </div>
                </div>
            </div>
            
            <div class="schedule-container" id="schedule-container">
                <div class="schedule-header">
                    <span>Amortization Schedule</span>
                    <button id="toggle-btn" onclick="toggleSchedule()">Show All</button>
                </div>
                <table class="schedule-table">
                    <thead>
                        <tr><th>#</th><th>Payment</th><th>Principal</th><th>Interest</th><th>Balance</th></tr>
                    </thead>
                    <tbody id="schedule-body"></tbody>
                </table>
            </div>
        </div>
        
        <div class="footer">
            © The Finance Framework — Professor Gautam Kaul<br>
            University of Michigan<br>
            <a href="index.html" style="color: #00274C; margin-top: 8px; display: inline-block;">← All Calculators</a>
        </div>
    </div>
    
    <script>
        let fullSchedule = [];
        let showAll = false;
        
        function calculate() {
            const principal = parseFloat(document.getElementById('principal').value);
            const annualRate = parseFloat(document.getElementById('annualRate').value) / 100;
            const loanTerm = parseFloat(document.getElementById('loanTerm').value);
            const frequency = parseInt(document.getElementById('frequency').value);
            
            const errorBox = document.getElementById('error');
            const summaryBox = document.getElementById('summary');
            const scheduleContainer = document.getElementById('schedule-container');
            
            errorBox.style.display = 'none';
            summaryBox.style.display = 'none';
            scheduleContainer.style.display = 'none';
            
            try {
                if (isNaN(principal) || principal <= 0) throw new Error('Please enter a valid loan amount');
                if (isNaN(annualRate) || annualRate < 0) throw new Error('Please enter a valid interest rate');
                if (isNaN(loanTerm) || loanTerm <= 0) throw new Error('Please enter a valid loan term');
                
                const periodicRate = annualRate / frequency;
                const totalPeriods = Math.round(loanTerm * frequency);
                
                let payment = periodicRate === 0 ? principal / totalPeriods : principal * periodicRate / (1 - Math.pow(1 + periodicRate, -totalPeriods));
                
                fullSchedule = [];
                let balance = principal;
                let totalInterest = 0;
                
                for (let i = 1; i <= totalPeriods; i++) {
                    const interestPayment = balance * periodicRate;
                    const principalPayment = payment - interestPayment;
                    balance = Math.max(0, balance - principalPayment);
                    totalInterest += interestPayment;
                    fullSchedule.push({ period: i, payment, principal: principalPayment, interest: interestPayment, balance });
                }
                
                const totalPayments = payment * totalPeriods;
                document.getElementById('summary-payment').textContent = formatCurrency(payment);
                document.getElementById('summary-total').textContent = formatCurrency(totalPayments);
                document.getElementById('summary-interest').textContent = formatCurrency(totalInterest);
                document.getElementById('summary-percent').textContent = (totalInterest / principal * 100).toFixed(1) + '%';
                
                summaryBox.style.display = 'block';
                showAll = false;
                document.getElementById('toggle-btn').textContent = 'Show All (' + totalPeriods + ')';
                renderSchedule();
                scheduleContainer.style.display = 'block';
            } catch (err) {
                errorBox.textContent = err.message;
                errorBox.style.display = 'block';
            }
        }
        
        function renderSchedule() {
            const tbody = document.getElementById('schedule-body');
            const displayData = showAll ? fullSchedule : fullSchedule.slice(0, 12);
            tbody.innerHTML = displayData.map(row => `
                <tr>
                    <td>${row.period}</td>
                    <td>${formatCurrency(row.payment)}</td>
                    <td class="principal">${formatCurrency(row.principal)}</td>
                    <td class="interest">${formatCurrency(row.interest)}</td>
                    <td>${formatCurrency(row.balance)}</td>
                </tr>
            `).join('');
            if (!showAll && fullSchedule.length > 12) {
                tbody.innerHTML += `<tr><td colspan="5" style="text-align: center; color: #666; font-style: italic;">... ${fullSchedule.length - 12} more payments ...</td></tr>`;
            }
        }
        
        function toggleSchedule() {
            showAll = !showAll;
            document.getElementById('toggle-btn').textContent = showAll ? 'Show Less' : 'Show All (' + fullSchedule.length + ')';
            renderSchedule();
        }
        
        function formatCurrency(value) {
            return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        function clearAll() {
            document.getElementById('principal').value = '';
            document.getElementById('annualRate').value = '';
            document.getElementById('loanTerm').value = '';
            document.getElementById('frequency').value = '12';
            document.getElementById('error').style.display = 'none';
            document.getElementById('summary').style.display = 'none';
            document.getElementById('schedule-container').style.display = 'none';
            fullSchedule = [];
        }
    </script>
</body>
</html>
